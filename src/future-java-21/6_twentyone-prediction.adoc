== The risky Part: Java 21

image::images/Plug_duke.png[400,400]

=== Candidates

* https://openjdk.org/jeps/440[Finalization of Record Patterns] ðŸ
* https://openjdk.org/jeps/441[Pattern Matching for Switch] ðŸ
* https://openjdk.org/jeps/439[Generational ZGC] ðŸŽ‰

=== Drafts

* https://openjdk.org/jeps/8304357[Scoped Values ðŸ”¬]
* https://openjdk.org/jeps/8303683[Virtual Threads ðŸ]
* https://openjdk.org/jeps/8303167[Windows 32 Deprecation âš ï¸]
* https://openjdk.org/jeps/8302326[Anonymous Main Class and enhanced Main Methode ðŸ”¬]

=== How does it Look?

image::images/BeispielKlasssenDiagramm.svg[]

=== Domain Modeling

Sources: https://github.com/MBoegers/DataOrientedJava[github.com/MBoegers/DataOrientedJava]

[source,java]
----
sealed interface Kunde permits Businesskunde, Privatkunde,
  TestKunde { String name(); String mail(); }

record Privatkunde(String name, String mail)
  implements Kunde {}

record Businesskunde(String name, String mail,
  boolean isVorsteuerAbzugsberechtigt) implements Kunde {}

record TestKunde(String name, String mail) implements Kunde {}
----

=== Flow Controll

[source,java]
----
static double calculateMwSt(Kunde kunde, double wert) {
  return switch (kunde) {
    case Businesskunde b when b.isVorsteuerAbzugsberechtigt()
        -> 0.0d;
    case Businesskunde b -> wert * 0.1d;
    case Privatkunde p -> wert * 0.1d;
  };
}
----

=== Deconstruction

[source,java]
----
switch (rechnung) {
  case InterneVerechnung(var abt, double wert) ->
    Dummy.storeInDB(abt, wert);
  case ExternVersandt(Kunde kunde, var wert) -> {
    double mwst = calculateMwSt(kunde, wert);
    var txt = formatMail(kunde.name(), wert, mwst);
    Dummy.sendViaMail(kunde.mail(), txt);
  }
}
----

=== String interpolation

[source,java]
----
String mailText =  """
Hallo %s, Bitte senden Sie uns den Rechnungsbetrag in HÃ¶he
von %.2fâ‚¬ plus %.2fâ‚¬ MwSt.

Mit freundlichen GrÃ¼ÃŸen
    Merlin BÃ¶gershausen
""".formatted(name, wert, mwst);
----

=== Concurrency

[source,java]
----
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
  var future1 = executor.submit(() -> fetchURL(url1));
  var future2 = executor.submit(() -> fetchURL(url2));
  response.send(future1.get() + future2.get());
} catch (ExecutionException | InterruptedException e) {
  response.fail(e);
}
----
