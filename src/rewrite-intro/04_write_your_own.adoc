== Write your own
image::images/frau-die-holzbretter-kratzt.jpg[background,size=cover]

[.notes]
--
Jetzt m√∂chte ich euch no zeigen welche M√∂glichkeiten es gibt eigene Refactorings zu definieren.
Wir k√∂nnen ihr nicht ganz tief einsteigen aber es wird als Vorgeschmack f√ºr die JavaLand funktionieren.
--

[.columns]
=== Declarative

[.column]
--
image::../../_shared/images/dukes/Reward.svg[]
--

[.column]
--
If it can be *declarative*,

do it *declarative*!
--

[.notes]
--
Open Rewrite hat eine riesige Sammlung an vorhandenen Recipes.

Viele von denen sind generisch wie AddDependency, AddAnnotation.

Ein Beispiel aus der Enterprise Welt wo wir Declarative Rezepte einsetzten koennen
--

=== Declarative Example

[source, java]
....
class SomeCallee {
  @java.lang.SuppressWarnings("deprecation") // ü§°
  void doIllegalStuff() {
    someService.oldOperation(); // ok..
  }
}

class SomeService {
  @java.lang.Deprecated
  void oldOperation(){/*..*/}
}
....

//[%step]
//--
//Remove SuppressWarnings to generate compile time warnings
//--

[.notes]
--
Wie Provisorien lebt auch Deprecated code fuer immer.

Hier haben wir eine Deorecated API SomeService#oldOperation.
Irgendwer hat es benutzt und weil es nervte oder IntelliJ es angeboten hat die Warning unterdr√ºckt.

Passiert aber wir haben keine Warning und common wenn wir mist machen dann lass uns auch dazu stehen.
Wir wollen die Supression entfernen, aber jetzt √ºberall.
Also STRG+R Supression such und erstezten f√ºhlt sich komisch an.
--

=== Remove Suppressions
[source,yaml]
....
---
type: specs.openrewrite.org/v1beta/recipe
name: io.github.mboegers.RemoveDeprecationSuppression
displayName: Remove SuppressWarnings for deprecation
recipeList:
  - org.openrewrite.java.RemoveAnnotation:
      annotationPattern: \
        '@java.lang.SuppressWarnings("deprecation")'
....

[.notes]
--
Ihr werdet es nicht glauben, es gibt da etwas von Open Rewrite.

Das allgemeine RemoveAnnotation Rezept.
Dieses Rezept ben√∂tigt konfiguration und kann dann ausgef√ºhrt werden.
Das Pattern ist angelehnt bzw. gleich zu AspectJ.

Weitere Konfiguration fast klar.
--

=== Result after execution

[source, java]
....
class SomeCallee {
  void doIllegalStuff() {
     someService.oldOperation();
  }
}

class SomeService { /*...*/ }
....

[source, bash]
....
Note: Some input files use or override a deprecated API.
Note: Recompile with -Xlint:deprecation for details.`
....

=== Refaster

image::images/Bildschirmfoto 2024-01-17 um 16.41.59.png[]

//Projektseite: https://errorprone.info/[ErrorProne.info]

[.notes]
--
Error Prone ist eine Statish Code Analyse von Google die auch Refactorings kann.
Error Prone nutzt daf√ºr Refaster, es erlaubt Methodenaufrufe zu ersetzten.

Diese Schnittstelle implementiert Open Rewrite auch, besonders hilfreich wenn man nur aufrufe wechseln will
--

=== Refaster Example

[source, java]
....
class SomeCallee {
  void doIllegalStuff() {
    someService.oldOperation(); // ‚ö†Ô∏è
  }
}

class SomeService {
  @java.lang.Deprecated
  void oldOperation(){/*..*/}
  void betterOperation(){/*..*/}
}
....

//[%step]
//--
//switch from `oldOperation` to `newOperation`
//--

[.notes]
--
Wir machen weiter an unserem Beispiel. Diesmal wollen wir die Methoden austauschen.

und daf√ºr schreiben wir ein Refaster Recipe welches oldOperation gegen newOperation austauscht
--

=== Refaster Recipe

[source, java]
....
@RecipeDescriptor(
  name = "Replace oldOperation with betterOperation",
  description = "Replace deprecated ¬¥oldOperation¬¥ " +
                "with surrogate ¬¥betterOperation¬¥")
public static class ReplaceOldOperation {
  @BeforeTemplate
  public void oldOperation(SomeService s) {
    s.oldOperation();
  }
  @AfterTemplate
  public void newOperation(SomeService s) {
    s.betterOperation();
  }
}
....

[.notes]
--
Diesmal als Java Klasse mit Annotations f√ºr die namen usqw.

Wichtig ist hier Before und After, es gibt auch alternative
--

=== Refaster Result

[source, java]
....
class SomeCallee {
  void doIllegalStuff() {
    someService.betterOperation(); // üëå
  }
}

class SomeService {
  @java.lang.Deprecated
  void oldOperation(){/*..*/}
  void betterOperation(){/*..*/}
}
....
